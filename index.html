<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cluster Origin-Destination Flow Data • flowcluster</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Cluster Origin-Destination Flow Data">
<meta name="description" content="Provides functionality for clustering origin-destination (OD) pairs, representing desire lines (or flows). This includes creating distance matrices between OD pairs and passing distance matrices to a clustering algorithm. See the academic paper Tao and Thill (2016) &lt;doi:10.1111/gean.12100&gt; for more details on spatial clustering of flows.">
<meta property="og:description" content="Provides functionality for clustering origin-destination (OD) pairs, representing desire lines (or flows). This includes creating distance matrices between OD pairs and passing distance matrices to a clustering algorithm. See the academic paper Tao and Thill (2016) &lt;doi:10.1111/gean.12100&gt; for more details on spatial clustering of flows.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">flowcluster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="flowcluster">flowcluster<a class="anchor" aria-label="anchor" href="#flowcluster"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>The goal of flowcluster is to provide minimal functionality for clustering origin-destination (OD) pairs, representing desire lines (or flows). This includes:</p>
<ol style="list-style-type: decimal">
<li>Creating distance matrices between OD pairs</li>
<li>Passing distance matrices to a clustering algorithm</li>
</ol>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the released version of <code>flowcluster</code> from <a href="https://CRAN.R-project.org/package=flowcluster" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"flowcluster"</span><span class="op">)</span></span></code></pre></div>
<p>And the development version from <a href="https://github.com/Hussein-Mahfouz/flowcluster" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Hussein-Mahfouz/flowcluster"</span><span class="op">)</span></span></code></pre></div>
<p>Load it as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hussein-mahfouz.github.io/flowcluster/">flowcluster</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The package provides a function to create a distance matrix from a data frame of OD pairs, and then pass that matrix to a clustering algorithm. The current distance matrix is an implementation of the flow distance and flow dissimilarity measures described in (Tao and Thill 2016).</p>
<div class="section level3">
<h3 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h3>
<p>First, load the flowcluster package and the sample data, and project it to a <a href="https://r.geocompx.org/spatial-class#projected-coordinate-reference-systems" class="external-link">projected</a> coordinate reference system (CRS).<br>
This is important for accurate length calculations and spatial operations.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load sample flow data and project to metric CRS (e.g., EPSG:27700)</span></span>
<span><span class="va">flows_sf</span> <span class="op">&lt;-</span> <span class="va">flows_leeds</span></span>
<span><span class="va">flows_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">flows_sf</span>, <span class="st">"EPSG:27700"</span><span class="op">)</span></span></code></pre></div>
<p>Next, add a column containing the length (in meters) of each flow line.<br>
This step also checks that your data is in a projected CRS.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add length (meters) to each flow line</span></span>
<span><span class="va">flows_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/add_flow_length.html">add_flow_length</a></span><span class="op">(</span><span class="va">flows_sf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">flows_sf</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>Simple feature collection with <span class="dv">5</span> features and <span class="dv">4</span> fields</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>Geometry type<span class="sc">:</span> LINESTRING</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>Dimension<span class="sc">:</span>     XY</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>Bounding box<span class="sc">:</span>  xmin<span class="sc">:</span> <span class="fl">419427.1</span> ymin<span class="sc">:</span> <span class="fl">443211.1</span> xmax<span class="sc">:</span> <span class="dv">443015</span> ymax<span class="sc">:</span> <span class="dv">448448</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>Projected CRS<span class="sc">:</span> OSGB36 <span class="sc">/</span> British National Grid</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co"># A tibble: 5 × 5</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  origin    destination count                             geometry length_m</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>                     <span class="er">&lt;</span>LINESTRING [m]<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="dv">1</span> E02002330 E02002330      <span class="dv">30</span>   (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">439593.3</span> <span class="dv">448448</span>)       <span class="dv">0</span> </span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="dv">2</span> E02002330 E02002331     <span class="dv">366</span>   (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="dv">443015</span> <span class="fl">447640.9</span>)    <span class="fl">3516.</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="dv">3</span> E02002330 E02002332       <span class="dv">6</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">419427.1</span> <span class="fl">446200.1</span>)   <span class="fl">20291.</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="dv">4</span> E02002330 E02002333       <span class="dv">2</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">420574.6</span> <span class="fl">444971.5</span>)   <span class="fl">19334.</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="dv">5</span> E02002330 E02002334      <span class="dv">31</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">442341.2</span> <span class="fl">443211.1</span>)    <span class="fl">5914.</span></span></code></pre></div>
<p>Filter out flows based on a minimum and maximum length. In the code below, we filter flows to keep only those between 1 and 20 kilometers.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter flows based on length (e.g., between 100 and 10000 meters)</span></span>
<span><span class="va">flows_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/filter_by_length.html">filter_by_length</a></span><span class="op">(</span><span class="va">flows_sf</span>, length_min <span class="op">=</span> <span class="fl">1000</span>, length_max <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span></code></pre></div>
<p>Then, extract start and end coordinates for each flow, and assign unique IDs.<br>
These are needed for subsequent distance calculations and clustering.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add start/end coordinates and unique flow IDs</span></span>
<span><span class="va">flows_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/add_xyuv.html">add_xyuv</a></span><span class="op">(</span><span class="va">flows_sf</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">flows_sf</span>, <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>Simple feature collection with <span class="dv">5</span> features and <span class="dv">9</span> fields</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>Geometry type<span class="sc">:</span> LINESTRING</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>Dimension<span class="sc">:</span>     XY</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>Bounding box<span class="sc">:</span>  xmin<span class="sc">:</span> <span class="fl">420574.6</span> ymin<span class="sc">:</span> <span class="fl">443211.1</span> xmax<span class="sc">:</span> <span class="dv">443015</span> ymax<span class="sc">:</span> <span class="dv">448448</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>Projected CRS<span class="sc">:</span> OSGB36 <span class="sc">/</span> British National Grid</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co"># A tibble: 5 × 10</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>  origin    destination count                    geometry length_m      x      y</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>            <span class="er">&lt;</span>LINESTRING [m]<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="dv">1</span> E02002330 E02002331     <span class="dv">366</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="dv">443015</span> <span class="dv">4</span>…    <span class="fl">3516.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="dv">2</span> E02002330 E02002333       <span class="dv">2</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">420574.6</span>…   <span class="fl">19334.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="dv">3</span> E02002330 E02002334      <span class="dv">31</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">442341.2</span>…    <span class="fl">5914.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="dv">4</span> E02002330 E02002335      <span class="dv">17</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">434926.1</span>…    <span class="fl">6385.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="dv">5</span> E02002330 E02002336       <span class="dv">5</span> (<span class="fl">439593.3</span> <span class="dv">448448</span>, <span class="fl">424754.2</span>…   <span class="fl">15687.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co"># ℹ 3 more variables: u &lt;dbl&gt;, v &lt;dbl&gt;, flow_ID &lt;chr&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="distance-matrix-calculation">Distance Matrix calculation<a class="anchor" aria-label="anchor" href="#distance-matrix-calculation"></a>
</h3>
<p>Calculate a pairwise distance measure between all flows using their coordinates.<br>
You can adjust <code>alpha</code> and <code>beta</code> to change the relative importance of start and end locations in the clustering process.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute pairwise flow distances (fd and fds columns)</span></span>
<span><span class="va">flows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">flows_sf</span><span class="op">)</span></span>
<span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flow_distance.html">flow_distance</a></span><span class="op">(</span><span class="va">flows</span>, alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Convert the long-format distance table to a matrix, which is required for clustering.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a distance matrix from the long-form distance data. Choose the column for distances you want to use.</span></span>
<span><span class="co"># The 'fds' column is the flow dissimilarity measure, and the 'fd' column is the flow distance measure.</span></span>
<span><span class="va">dmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/distance_matrix.html">distance_matrix</a></span><span class="op">(</span><span class="va">distances</span>, distance_col <span class="op">=</span> <span class="st">"fds"</span><span class="op">)</span></span>
<span><span class="co"># check 1st couple of rows columns of the distance matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dmat</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>                        E02002330_1<span class="sc">-</span>E02002331_2 E02002330_1<span class="sc">-</span>E02002333_4</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>E02002330_1<span class="sc">-</span>E02002331_2                <span class="fl">0.000000</span>                <span class="fl">2.741081</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>E02002330_1<span class="sc">-</span>E02002333_4                <span class="fl">2.741081</span>                <span class="fl">0.000000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h3>
<p>Prepare a weight vector, typically based on a “count” column (number of trips, etc).<br>
If your data does not have a “count” column, you can add one with <code>flows$count &lt;- 1</code>. Weights are very handy, otherwise our matrix would be huge, as we would have to replicate each OD pair n times depending on the number of observations between them. Unfortunately, there is no out-of-the-box support for adding weights in other clustering algorithms such as <code>hdbscan</code> or <code>optics</code>, so we will use {<a href="https://github.com/mhahsler/dbscan" class="external-link">dbscan</a>} for now, which does support weights.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare weights for each flow (here we use the count column)</span></span>
<span><span class="va">wvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/weight_vector.html">weight_vector</a></span><span class="op">(</span><span class="va">dmat</span>, <span class="va">flows</span>, weight_col <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, cluster the flows using DBSCAN.<br>
Adjust <code>eps</code> and <code>minPts</code> to control cluster tightness and minimum cluster size. Cluster composition is determined by these DBSCAN parameters.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Cluster flows using DBSCAN</span></span>
<span><span class="va">flows_clustered</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/cluster_flows_dbscan.html">cluster_flows_dbscan</a></span><span class="op">(</span><span class="va">dmat</span>, <span class="va">wvec</span>, <span class="va">flows</span>, eps <span class="op">=</span> <span class="fl">8</span>, minPts <span class="op">=</span> <span class="fl">70</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View the first few rows of the clustered data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">flows_clustered</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># A tibble: 10 × 10</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>   origin destination count length_m      x      y      u      v flow_ID cluster</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>  <span class="er">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span> <span class="er">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a> <span class="dv">1</span> E0200… E02002331     <span class="dv">366</span>    <span class="fl">3516.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.43e5</span> <span class="fl">4.48e5</span> E02002…       <span class="dv">1</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a> <span class="dv">2</span> E0200… E02002333       <span class="dv">2</span>   <span class="fl">19334.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.21e5</span> <span class="fl">4.45e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a> <span class="dv">3</span> E0200… E02002334      <span class="dv">31</span>    <span class="fl">5914.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.42e5</span> <span class="fl">4.43e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a> <span class="dv">4</span> E0200… E02002335      <span class="dv">17</span>    <span class="fl">6385.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.35e5</span> <span class="fl">4.44e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a> <span class="dv">5</span> E0200… E02002336       <span class="dv">5</span>   <span class="fl">15687.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.25e5</span> <span class="fl">4.43e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a> <span class="dv">6</span> E0200… E02002341       <span class="dv">9</span>   <span class="fl">12306.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.29e5</span> <span class="fl">4.42e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a> <span class="dv">7</span> E0200… E02002344       <span class="dv">7</span>   <span class="fl">11883.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.31e5</span> <span class="fl">4.40e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a> <span class="dv">8</span> E0200… E02002345       <span class="dv">1</span>   <span class="fl">14937.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.27e5</span> <span class="fl">4.40e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a> <span class="dv">9</span> E0200… E02002346       <span class="dv">2</span>   <span class="fl">16966.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.25e5</span> <span class="fl">4.39e5</span> E02002…       <span class="dv">0</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="dv">10</span> E0200… E02002347       <span class="dv">3</span>   <span class="fl">13534.</span> <span class="fl">4.40e5</span> <span class="fl">4.48e5</span> <span class="fl">4.30e5</span> <span class="fl">4.39e5</span> E02002…       <span class="dv">0</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># how many unique clusters were found?</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">flows_clustered</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>[<span class="dv">1</span>] <span class="dv">317</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of flows in each cluster</span></span>
<span><span class="va">flows_clustered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># A tibble: 317 × 2</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>   cluster     n</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>     <span class="sc">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a> <span class="dv">1</span>       <span class="dv">0</span>  <span class="dv">8652</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a> <span class="dv">2</span>      <span class="dv">14</span>   <span class="dv">179</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a> <span class="dv">3</span>       <span class="dv">4</span>    <span class="dv">62</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a> <span class="dv">4</span>     <span class="dv">104</span>    <span class="dv">57</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a> <span class="dv">5</span>     <span class="dv">187</span>    <span class="dv">56</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a> <span class="dv">6</span>      <span class="dv">28</span>    <span class="dv">42</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a> <span class="dv">7</span>       <span class="dv">2</span>    <span class="dv">35</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a> <span class="dv">8</span>      <span class="dv">74</span>    <span class="dv">29</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a> <span class="dv">9</span>     <span class="dv">228</span>    <span class="dv">29</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="dv">10</span>       <span class="dv">6</span>    <span class="dv">26</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co"># ℹ 307 more rows</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualise">Visualise<a class="anchor" aria-label="anchor" href="#visualise"></a>
</h3>
<p>Let’s take a look at the clusters</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Keep only the biggest clusters for visualisation</span></span>
<span><span class="va">flows_clustered</span> <span class="op">&lt;-</span> <span class="va">flows_clustered</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cluster</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co"># these are normally the noisepoints</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    size <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    count_cluster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">size</span> <span class="op">&gt;</span> <span class="fl">7</span>, <span class="co"># minimum size of cluster</span></span>
<span>    <span class="va">count_cluster</span> <span class="op">&gt;</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span> <span class="co"># minumum number of trips in cluster</span></span></code></pre></div>
<p>Add geometry back onto the data</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Add the geometry back onto the data</span></span>
<span><span class="va">flows_clustered</span> <span class="op">&lt;-</span> <span class="va">flows_sf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">flow_ID</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">flows_clustered</span>, by <span class="op">=</span> <span class="st">"flow_ID"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot</span></span>
<span><span class="fu">tm_shape</span><span class="op">(</span><span class="va">flows_clustered</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_lines</span><span class="op">(</span></span>
<span>    lwd <span class="op">=</span> <span class="st">"count"</span>,</span>
<span>    col <span class="op">=</span> <span class="st">"cluster"</span>,</span>
<span>    palette <span class="op">=</span> <span class="st">"Accent"</span>, <span class="co"># YlGn</span></span>
<span>    <span class="co"># style = "pretty",</span></span>
<span>    alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    title.col <span class="op">=</span> <span class="st">"Cluster"</span>,</span>
<span>    title.lwd <span class="op">=</span> <span class="st">"No. of people"</span>,</span>
<span>    scale <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    legend.col.show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    showNA <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_facets</span><span class="op">(</span></span>
<span>    by <span class="op">=</span> <span class="st">"cluster"</span>,</span>
<span>    free.coords <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    nrow <span class="op">=</span> <span class="fl">4</span>,</span>
<span>    showNA <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">tm_layout</span><span class="op">(</span></span>
<span>    fontfamily <span class="op">=</span> <span class="st">"Georgia"</span>,</span>
<span>    main.title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Clustered flows"</span><span class="op">)</span>,</span>
<span>    main.title.size <span class="op">=</span> <span class="fl">1.1</span>,</span>
<span>    main.title.color <span class="op">=</span> <span class="st">"azure4"</span>,</span>
<span>    main.title.position <span class="op">=</span> <span class="st">"left"</span>,</span>
<span>    legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend.outside.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    legend.stack <span class="op">=</span> <span class="st">"horizontal"</span>,</span>
<span>    <span class="co"># remove panel headers</span></span>
<span>    <span class="co"># panel.show = FALSE,</span></span>
<span>    frame <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">cluster_results</span></span>
<span></span>
<span><span class="va">cluster_results</span></span></code></pre></div>
<p><img src="reference/figures/cluster_results.png"></p>
<p>The package also has a function to test different combinations of input parameters (<code>eps</code> and <code>minPts</code>) to see how the clustering changes. This can be useful for preliminary sensitivity analysis.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sensitivity_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dbscan_sensitivity.html">dbscan_sensitivity</a></span><span class="op">(</span></span>
<span>  flows <span class="op">=</span> <span class="va">flows</span>,</span>
<span>  dist_mat <span class="op">=</span> <span class="va">dmat</span>,</span>
<span>  <span class="va">options_epsilon</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">7.5</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>  <span class="va">options_minpts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">75</span>, <span class="fl">100</span>, <span class="fl">150</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sensitivity_results</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># A tibble: 6 × 4</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>  id              cluster  size count_sum</span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>             <span class="er">&lt;</span>int<span class="sc">&gt;</span> <span class="er">&lt;</span>int<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="dv">1</span> eps_1_minpts_50       <span class="dv">0</span>  <span class="dv">9274</span>     <span class="dv">80815</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="dv">2</span> eps_1_minpts_50       <span class="dv">1</span>     <span class="dv">1</span>       <span class="dv">366</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="dv">3</span> eps_1_minpts_50       <span class="dv">2</span>     <span class="dv">1</span>        <span class="dv">71</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="dv">4</span> eps_1_minpts_50       <span class="dv">3</span>     <span class="dv">1</span>        <span class="dv">61</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="dv">5</span> eps_1_minpts_50       <span class="dv">4</span>     <span class="dv">1</span>        <span class="dv">82</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="dv">6</span> eps_1_minpts_50       <span class="dv">5</span>     <span class="dv">1</span>       <span class="dv">342</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># number of clusters with more than five od pairs:</span></span>
<span><span class="va">sensitivity_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">size</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    no_of_clusters <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count_sum</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">no_of_clusters</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="co"># A tibble: 20 × 3</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>   id                 no_of_clusters total_count</span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>   <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                       <span class="er">&lt;</span>int<span class="sc">&gt;</span>       <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a> <span class="dv">1</span> eps_7<span class="fl">.5</span>_minpts_50              <span class="dv">47</span>       <span class="dv">82404</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a> <span class="dv">2</span> eps_9_minpts_75                <span class="dv">47</span>       <span class="dv">98085</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a> <span class="dv">3</span> eps_9_minpts_50                <span class="dv">46</span>       <span class="dv">85491</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a> <span class="dv">4</span> eps_9_minpts_100               <span class="dv">28</span>      <span class="dv">105479</span></span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a> <span class="dv">5</span> eps_7<span class="fl">.5</span>_minpts_75              <span class="dv">26</span>       <span class="dv">94718</span></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a> <span class="dv">6</span> eps_7<span class="fl">.5</span>_minpts_100             <span class="dv">22</span>      <span class="dv">102502</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a> <span class="dv">7</span> eps_9_minpts_150               <span class="dv">18</span>      <span class="dv">113117</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a> <span class="dv">8</span> eps_7<span class="fl">.5</span>_minpts_150             <span class="dv">14</span>      <span class="dv">110810</span></span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a> <span class="dv">9</span> eps_5_minpts_50                 <span class="dv">6</span>       <span class="dv">80175</span></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a><span class="dv">10</span> eps_5_minpts_75                 <span class="dv">4</span>       <span class="dv">93612</span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a><span class="dv">11</span> eps_5_minpts_100                <span class="dv">3</span>      <span class="dv">102246</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a><span class="dv">12</span> eps_1_minpts_100                <span class="dv">1</span>      <span class="dv">102797</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a><span class="dv">13</span> eps_1_minpts_150                <span class="dv">1</span>      <span class="dv">111862</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a><span class="dv">14</span> eps_1_minpts_50                 <span class="dv">1</span>       <span class="dv">80815</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a><span class="dv">15</span> eps_1_minpts_75                 <span class="dv">1</span>       <span class="dv">94111</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a><span class="dv">16</span> eps_2_minpts_100                <span class="dv">1</span>      <span class="dv">102797</span></span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a><span class="dv">17</span> eps_2_minpts_150                <span class="dv">1</span>      <span class="dv">111862</span></span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a><span class="dv">18</span> eps_2_minpts_50                 <span class="dv">1</span>       <span class="dv">80815</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a><span class="dv">19</span> eps_2_minpts_75                 <span class="dv">1</span>       <span class="dv">94111</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a><span class="dv">20</span> eps_5_minpts_150                <span class="dv">1</span>      <span class="dv">111443</span></span></code></pre></div>
<p>Let’s plot the output</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sensitivity_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cluster</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>clusters <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># How many clusters have more than 5 od pairs in them?</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>clusters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">size</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">clusters</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cluster</span>, y <span class="op">=</span> <span class="va">size</span>, fill <span class="op">=</span> <span class="va">count_sum</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">id</span>, scales <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Sensitivity analysis for clustering - Varying {eps} and {minPts}"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Parameter combinations that returned more than 1 cluster"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Cluster no."</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"No. of od pairs in cluster"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"No. of \ncommuters"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="reference/figures/sensitivity_results.png" alt="Size and commuter count of detected clusters across DBSCAN parameter combinations. Each facet shows results for one {eps, minPts} setting; bar height represents the number of OD pairs in a cluster (log scale), and fill indicates the total count in that OD pair"><div class="figcaption">Size and commuter count of detected clusters across DBSCAN parameter combinations. Each facet shows results for one {eps, minPts} setting; bar height represents the number of OD pairs in a cluster (log scale), and fill indicates the total count in that OD pair</div>
</div>
<p>The plot shows the number of origin-destination pairs in each cluster. For each facet, each bar represents a cluster, and the height of the bar indicates the number of origin-destination pairs in that cluster. Many of the parameter (<code>minPts</code> and <code>eps</code>) combinations returned no clusters, and the combinations that did return clusters are shown in the plot. Depending on the analysis being done, you could proceed with the promising combinations, visualise them as done in the map above, and choose the one that makes the most sense to you.</p>
</div>
</div>
<div class="section level2">
<h2 id="future-work">Future Work<a class="anchor" aria-label="anchor" href="#future-work"></a>
</h2>
<ul class="task-list">
<li><label><input type="checkbox">Add more distance matrices (e.g. Frechet distance)</label></li>
<li><label><input type="checkbox">Add more clustering algorithms, and use a more efficient data structure as a workaround for not being able to use weights with other clustering algorithms</label></li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-tao2016spatial" class="csl-entry">
Tao, Ran, and Jean-Claude Thill. 2016. “Spatial Cluster Detection in Spatial Flow Data.” <em>Geographical Analysis</em> 48 (4): 355–72. <a href="https://doi.org/10.1111/gean.12100" class="external-link uri">https://doi.org/10.1111/gean.12100</a>.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=flowcluster" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing flowcluster</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Hussein Mahfouz <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-1706-7802" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
<li>Robin Lovelace <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0001-5679-6536" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/Hussein-Mahfouz/flowcluster/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/Hussein-Mahfouz/flowcluster/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/Hussein-Mahfouz/flowcluster" class="external-link"><img src="https://codecov.io/gh/Hussein-Mahfouz/flowcluster/graph/badge.svg" alt="codecov"></a></li>
<li><a href="https://cran.r-project.org/package=flowcluster" class="external-link"><img src="https://www.r-pkg.org/badges/version/flowcluster" alt="CRAN status"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hussein Mahfouz, Robin Lovelace.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
